<!doctype html>
<html lang="en">
<head>
  <script>
  var host = "graeme-lockley.github.io"
  if (window.location.host == host && window.location.protocol != "https:") {
    window.location.protocol = "https:"
  }
  </script>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="author" content="graemel@no9.co.za">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>Value objects and Java</title>

  <link href="/assets/stylesheets/application-5f1b61a5.css" media="screen" rel="stylesheet" type="text/css" />
  <!-- <link href="/assets/stylesheets/Skeleton-2.0.4/normalize-510da396.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/assets/stylesheets/Skeleton-2.0.4/skeleton-9b4967f6.css" media="screen" rel="stylesheet" type="text/css" /> -->

  

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-74997490-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

<body class="posts posts_20160228-java-value-objects posts_20160228-java-value-objects_index">
  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

  <header class="site-header">
    <nav class="site-nav container" role="navigation">
  <a class="navbar-brand" href="/">
    Ideas in Software
  </a>

<!--
  <ul class="nav-links">
    <li><a href="/">home</a>
      <ul></ul>
    </li>
    <li><i class="fa fa-angle-double-right"></i><a href="/docs/">docs</a>
      <ul>
        <li><a href="/docs/bitters">bitters</a></li>
        <li><a href="/docs/markdown">markdown</a></li>
      </ul>
    </li>
    <li><i class="fa fa-angle-double-right"></i><a href="https://github.com/dnajd/rails-loaded">github</a>
      <ul>
        <li><a href="https://github.com/dnajd/rails-loaded">rails</a></li>
        <li><a href="https://github.com/dnajd/middleman-loaded">middleman</a></li>
        <li><a href="https://github.com/dnajd/ruby_tester">ruby tester</a></li>
        <li><a href="https://github.com/dnajd/load_runner">load runner</a></li>
      </ul>
    </li>
  </ul>
-->

  <!-- <div class="mobile-menu"><i class="fa fa-navicon"></i></div> -->
</nav>

  </header>

  <main class="site-main">
    <div class="container module">
      <div class="row">
        <div class="twelve columns">
          <h1 id="value-objects-and-java">Value Objects and Java</h1>

<p>Recently I was involved in developing an application that had the following non-functional requirements:</p>

<ul class="default-ul">
  <li>The application would receive a continuous stream of concurrent REST requests,</li>
  <li>Concurrent requests would be received against a shared state and would need to update the shared state,</li>
  <li>The inbound requests are modelled in the form of events with any event able to be raised irrespective of what state the application is in, and</li>
  <li>Down stream service providers were not guaranteed to be reliable.</li>
</ul>

<p>Although I am not going to describe the architecture of the application in any further detail it is worthwhile to note the following:</p>

<ul class="default-ul">
  <li>Updating of the shared state was restricted to as small a piece of code as possible.  Factually this application had 100 files totalling just under 5,000 lines of Java source. Concurrency control was restricted to 3 files of which 2 were managing a shared dictionary whilst the third performed the true concurrency control.</li>
  <li>The module was layered using a hexagonal architecture - we did enjoy the anticipated benefits of a hexagonal architecture through an isolated business model, adaptors to describe dependency boundaries and ports managing the detail of inbound requests and outbound services.</li>
  <li>Apart from the 3 classes described above all other classes were modelled and developed as value objects.</li>
</ul>

<h2 id="value-object-structure">Value Object Structure</h2>

<p>One of our value objects was to record a user's Active Directory name.  Usually this value would have been held in a <code>String</code> and passed around the application as a <code>String</code>.  In this project we used the following class to represent this concept.</p>

<pre class="highlight java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ADName</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">ADName</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="n">ADName</span> <span class="n">from</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="n">ADName</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="n">asString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">userName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">boolean</span> <span class="n">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="n">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<p>A couple of comments on this style:</p>

<ul class="default-ul">
  <li>The classes fields are always marked as final.  This allows the compiler to support us in ensuring that we do not accidentally update the field, and with tool support, confirm that the constructor assigns a value to each field.</li>
  <li>One or more static <code>from</code> methods are used as factory methods to create instances of the value object.</li>
  <li>The constructor is always made private and receives a value for each of the classes fields.  The reason for this is that instances of this class are created using the static <code>from</code> methods.</li>
  <li>We used <code>as</code> methods to expose the atomic elements of a value object.  We could have used a <code>toString</code> but found that the purpose of <code>asString</code> and <code>toString</code> are different - <code>asString</code> is aligned with the business domain whilst the <code>toString</code> is aligned to the developer and more often used for logging purposes.  We found that creating a strict usage for <code>toString</code> improved the quality of this method.</li>
  <li>We always created an <code>equals</code> and <code>hashCode</code> method as we could then treat value objects as key fields within maps.</li>
</ul>

<h2 id="benefits">Benefits</h2>

<p>Following the completion of this project we noted the following benefits of using value objects.</p>

<ul class="default-ul">
  <li>No locking - we never had to think about this and by isolating concurrency control the rest of the application was nothing more than a non-threaded deterministic application which we were able to subject to non-brittle unit testing.</li>
  <li>Easy to create and FAST - the <code>from</code> methods made object creation straightforward and by carefully selecting the class names were closely aligned with the ubiquitous language.</li>
  <li>Never being concerned with state mutation means never having to manage the consistency of an object's internal state other than at object creation.</li>
  <li>Given that Java is strongly typed there was never the problem of accidentaly assigning incompatible values to each other.  This would not have been the case if we had made the user's Active Directory name a <code>String</code>.</li>
  <li>During the development we had a change in requirement which resulted in us representing a business concept as two separate value objects rather than a single value object.  The refactoring was straightforward as we were able to lean on the compiler to identify the usage of the former value object and then to safely introduce the new classes.</li>
</ul>

<h2 id="observations">Observations</h2>

<ul class="default-ul">
  <li>Worked really well - the value derived far exceeded the extra lines of code that was necessary to support.</li>
  <li>Splitting a value object into two values objects and being able to lean on the compiler was massive.</li>
  <li>Functionally things just worked - there was no go-live (or take-off) anxiety.</li>
</ul>


          
          <hr>
          <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
          <div class="fb-like" data-href="https://graeme-lockley.github.io/posts/20160228-java-value-objects/" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
            <!-- posts/20160228-java-value-objects.html -->
          
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2017 <a href="https://github.com/graeme-lockley">Ideas in Software</a></p>
    </div>
  </footer>

  <script src="/assets/javascripts/application-b1079a0e.js" type="text/javascript"></script>
  
</body>
</html>
